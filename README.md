# Paper #360
Due to technical issues with the Anonymous Github (https://anonymous.4open.science/), we decide to use this repo for our ICSE submission.


## How to run this tool

First, you need to download and run our docker image. 

```
$docker pull icsesub2022/paper360:artifact
$docker run --net=host -it --user postgres icsesub2022/paper360:artifact bash
$eval "$(direnv hook bash)"
$start_pg13.sh
$start_cockroach.sh
```
Then, you can run the following command to run our tool:

```
$cd /workspace
$timeout {total_timeout} ./test_driver.py --workers {num_workers} --output {outputfolder} --queries {num_queries_per_worker} --user postgres --rewriter ./calcite-fuzzing --dbms={dbms_undertest} --validate --update_time={num_feedbackloops} --feedback={conf_feedback} --dbconf=db_conf_demo.json --timeout {per_query_timeout}

```
> Several parameters you can change:
- {total_timeout}: timeout for the entire run
- {num_workers}: number of parallel workers that are leveraged for generating equivalent query pairs
- {outputfolder}: stores the generated bug reports and logfile
- {num_queries_per_worker}: number of queries that are generated by each run of the query generator
- {dbms_undertest}: `postgresql` or `cockroach`
- {num_feedbackloops}: number of feedback loops for the entire run
- {conf_feedback}: `both`, `none`, `mutator`, or `validator`
- {per_query_timeout}: timeout for each query


> For example, you can run the following command:
```
timeout 1800 ./test_driver.py --workers 1 --output ~/testexp --queries 100 --user postgres --rewriter ./calcite-fuzzing --dbms=cockroach --validate --update_time=1 --feedback=both --dbconf=db_conf_demo.json --timeout 20
```
> For this command, the tool should complete within 30 minutes. You can check the result in `~/testexp`. The detected bug report lives in `~/testexp/bugs.md`.


## How to navigate the source code within the docker

The source code resides in `/workspace`, which contains three main components of the tool:
- `./sqlfuzz`: Query Generator
- `./calcite-fuzzing`: Query Mutator
- `./validator.py`: Validator

## How to navigate the supplementary materials for the paper
In <b>anonymized supp material.xlsx</b>, you can find four spreadsheets:
- <b>bugs-found-cockroachdb</b>: a complete list of anonymized bug reports for CockroachDB
- <b>bugs-found-postgres</b>: a complete list of anonymized bug reports for PostgreSQL
- <b>mutation rules</b>: a complete list of mutations rules that the tool leverages
- <b>supported SQL features</b>: a complete list of SQL features that the tool supports